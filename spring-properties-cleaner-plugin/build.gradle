/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/8.13/userguide/building_java_projects.html in the Gradle documentation.
 */

plugins {
    id 'org.gradlex.maven-plugin-development' version '1.0.3'

    // y'know, for coverage
    id 'jacoco'

    // fine, let's lombok this one too
    id 'io.freefair.lombok' version '8.13'

    id 'com.diffplug.spotless' version '7.0.3'

    id 'signing'
    id 'maven-publish' 
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

spotless {
    java {
        palantirJavaFormat()
    }
}

signing {
//    useInMemoryPgpKeys(null, System.getenv("GPG_PRIVATE_KEY")?.replace("\\n", "\n"), System.getenv("GPG_PASSPHRASE"))
    useGpgCmd()
    sign publishing.publications
}

dependencies {
    implementation project(':app')

    implementation 'org.apache.maven:maven-plugin-api:3.6.3'
    compileOnly 'org.apache.maven.plugin-tools:maven-plugin-annotations:3.6.4'
    implementation 'org.apache.maven:maven-project:2.2.1'

    // add in Lombok because I gave up
    compileOnly 'org.projectlombok:lombok:1.18.36'
    annotationProcessor 'org.projectlombok:lombok:1.18.36'
    testCompileOnly 'org.projectlombok:lombok:1.18.36'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.36'

    // Use JUnit Jupiter for testing.
    testImplementation libs.junit.jupiter
    testImplementation 'org.assertj:assertj-core:3.27.3'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher:1.11.4'
    testImplementation 'org.mockito:mockito-junit-jupiter:5.16.1'

    testImplementation 'uk.org.webcompere:system-stubs-jupiter:2.1.7'
    testImplementation 'org.apache.maven:maven-core:3.6.3'
}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11) // import org.gradle.jvm.toolchain.JavaLanguageVersion if needed
    }
    withSourcesJar() // Generates the sources JAR
    withJavadocJar() // Generates the Javadoc JAR
}

test {
    useJUnitPlatform()
    finalizedBy jacocoTestReport
}

jacoco {
    toolVersion = "0.8.13"
}

tasks.jacocoTestReport {
    dependsOn tasks.test // Ensure tests run before generating reports

    reports {
        xml.required = true
        html.required = true
        csv.required = false
    }
}

publishing {
    publications {
        maven(MavenPublication) { // import org.gradle.api.publish.maven.MavenPublication if needed
            groupId = 'uk.org.webcompere'
            artifactId = 'spring-properties-cleaner-plugin'

            from components.java


            pom {
                name = project.name // Use the project's name for the POM name
                description = 'Spring Properties Cleaner - A utility to clean properties from Spring Boot applications.'
                // General description for the project
                url = 'https://github.com/webcompere/spring-properties-cleaner'

                licenses {
                    license {
                        name = 'MIT License'
                        url = 'https://github.com/webcompere/spring-properties-cleaner?tab=MIT-1-ov-file#readme'
                        distribution = 'repo' // Common distribution type
                    }
                }

                developers {
                    developer {
                        id = 'webcompere'
                        name = 'Ashley Frieze'
                        email = 'ashley@ashleyfrieze.co.uk'
                    }
                }

                scm {
                    connection = 'scm:git:https://github.com/webcompere/spring-properties-cleaner.git'
                    developerConnection = 'scm:git:git@github.com:webcompere/spring-properties-cleaner.git'
                    url = 'https://github.com/webcompere/spring-properties-cleaner.git'
                }

                organization {
                    name = 'WebCompere'
                    url = 'https://github.com/webcompere'
                }
            }
        }

    }
}
