/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/8.13/userguide/building_java_projects.html in the Gradle documentation.
 */
plugins {
    id("org.shipkit.shipkit-auto-version") version "2.1.2"
    id("org.shipkit.shipkit-changelog") version "2.0.1"
    id("org.shipkit.shipkit-github-release") version "2.0.1"
    id 'maven-publish'
    id("com.gradleup.nmcp.aggregation") version "0.1.4"
}

tasks.named("generateChangelog") {
    previousRevision = project.ext.'shipkit-auto-version.previous-tag'
    githubToken = System.getenv("GITHUB_TOKEN") // using env var to avoid checked-in secrets
    repository = "webcompere/spring-properties-cleaner"
}

tasks.named("githubRelease") {
    dependsOn tasks.named("generateChangelog")
    repository = "webcompere/spring-properties-cleaner"
    changelog = tasks.named("generateChangelog").get().outputFile
    githubToken = System.getenv("GITHUB_TOKEN") // using env var to avoid checked-in secrets
    newTagRevision = System.getenv("GITHUB_SHA")   // using an env var automatically exported by Github Actions
}

subprojects {
    // Configure all publications
    publishing {
        plugins.withId('maven-publish') {
            afterEvaluate {
                publications.withType(MavenPublication) {
                    pom {
                        name = project.name // Use the project's name for the POM name
                        description = 'Spring Properties Cleaner - A utility to clean properties from Spring Boot applications.'
                        // General description for the project
                        url = 'https://github.com/webcompere/spring-properties-cleaner'

                        licenses {
                            license {
                                name = 'MIT License'
                                url = 'https://github.com/webcompere/spring-properties-cleaner?tab=MIT-1-ov-file#readme'
                                distribution = 'repo' // Common distribution type
                            }
                        }

                        developers {
                            developer {
                                id = 'webcompere'
                                name = 'Ashley Frieze'
                                email = 'ashley@ashleyfrieze.co.uk'
                            }
                        }

                        scm {
                            connection = 'scm:git:https://github.com/webcompere/spring-properties-cleaner.git'
                            developerConnection = 'scm:git:git@github.com:webcompere/spring-properties-cleaner.git'
                            url = 'https://github.com/webcompere/spring-properties-cleaner.git'
                        }

                        organization {
                            name = 'WebCompere'
                            url = 'https://github.com/webcompere'
                        }
                    }
                }
            }
        }
    }

    nmcpAggregation {
        centralPortal {
            username = System.getenv("MAVEN_USERNAME")
            password = System.getenv("MAVEN_PASSWORD")
            // TODO  "AUTOMATIC"
            publishingType = "USER_MANAGED"
        }

        // Publish all projects that apply the 'maven-publish' plugin
        publishAllProjectsProbablyBreakingProjectIsolation()
    }

}